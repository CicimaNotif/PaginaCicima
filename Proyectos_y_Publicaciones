<!-- 
    ============================================================
    SECCI√ìN DE PROYECTOS Y PUBLICACIONES - CICIMA
    ============================================================
    Esta secci√≥n muestra informaci√≥n sobre proyectos, publicaciones
    y servicios del Centro de Investigaciones en Ciencia e Ingenier√≠a de Materiales
-->

<!-- 
    CELDA 1: INFORMACI√ìN GENERAL Y CONTACTO
    Contiene la descripci√≥n general del CICIMA y informaci√≥n de contacto
-->
<div class="cell-container">
    <div class="description">
        <p>
            Bienvenido a la secci√≥n de proyectos y publicaciones del Centro de Investigaciones en Ciencia e Ingenier√≠a de Materiales (CICIMA) de la Universidad de Costa Rica. Aqu√≠ podr√° consultar los proyectos acad√©micos actualmente vigentes, inscritos en la Vicerrector√≠a de Investigaci√≥n mediante el sistema SIGPRO, as√≠ como las publicaciones cient√≠ficas m√°s recientes desarrolladas por nuestro equipo de investigaci√≥n.
        </p>
        <p>
            El CICIMA ofrece servicios de investigaci√≥n especializados enfocados en la soluci√≥n de problemas industriales mediante an√°lisis integrales, caracterizaci√≥n avanzada de materiales y la interpretaci√≥n de datos por parte de un grupo interdisciplinario con experiencia en Ingenier√≠a, F√≠sica, Qu√≠mica, Microbiolog√≠a y Biolog√≠a. Adem√°s, contamos con instrumentaci√≥n de alta gama para el an√°lisis de materiales.
        </p>
        <p>
            La contrataci√≥n de estos servicios se gestiona a trav√©s de la Fundaci√≥n para la Investigaci√≥n de la Universidad de Costa Rica. El procedimiento incluye:
        </p>
        <!-- Lista de procedimientos para contrataci√≥n de servicios -->
        <ul>
            <li>
                La explicaci√≥n del problema a estudiar (incluyendo descripci√≥n de muestra y cantidad de ensayos).
            </li>
            <li>
                La coordinaci√≥n de una reuni√≥n sin costo para discutir el problema a abordar.
            </li>
        </ul>
        <!-- Secci√≥n de contacto con enlaces de correo -->
        <h3>
            Contacto
        </h3>
        <p>
            Dr. Esteban Avenda√±o ‚Äì <a href="mailto:esteban.avendanosoto@ucr.ac.cr">esteban.avendanosoto@ucr.ac.cr</a><br>
            Dra. Mavis L. Montero ‚Äì <a href="mailto:mavis.montero@ucr.ac.cr">mavis.montero@ucr.ac.cr</a><br>
            Lic. Jhonatan D. Alfaro Arbustini ‚Äì <a href="mailto:jhonatan.alfaro@ucr.ac.cr">jhonatan.alfaro@ucr.ac.cr</a>
        </p>
        <p>
            Para m√°s informaci√≥n, puede escribir a: <a href="mailto:cicima.ucr@ucr.ac.cr">cicima.ucr@ucr.ac.cr</a><br>
            Tel√©fonos: 2511-4110 / 2511-5903
        </p>
    </div>
</div>

<!-- 
    CELDA 2: PROYECTOS SIGPRO
    Muestra informaci√≥n sobre proyectos de investigaci√≥n y enlace al sistema SIGPRO
-->
<div class="cell-container">
    <!-- T√≠tulo de la secci√≥n -->
    <div class="custom-title">
        Proyectos
    </div>
    <div class="description centered-text">
        <p>
            El CICIMA cuenta con diversos proyectos de investigaci√≥n inscritos en el sistema SIGPRO de la Vicerrector√≠a de Investigaci√≥n de la UCR. Estos proyectos abordan temas como la s√≠ntesis y caracterizaci√≥n de nuevos materiales, la evaluaci√≥n de propiedades f√≠sico-qu√≠micas, y el desarrollo de soluciones tecnol√≥gicas aplicadas a la industria y al medio ambiente.
        </p>
    </div>
    <!-- Bot√≥n que redirige al sistema SIGPRO -->
    <div class="button-container">
        <a class="button btn-blue" href="https://vinv.ucr.ac.cr/sigpro/web/units/816?p_researcher=1&amp;%3Bp_project=1&amp;%3Bp_state=0&amp;%3Br_state=0#projects">Proyectos en SIGPRO</a>
    </div>
</div>

<!-- 
    CELDA 3: ESTAD√çSTICAS EN TIEMPO REAL
    Muestra estad√≠sticas din√°micas de publicaciones cient√≠ficas
-->
<div class="cell-container">
    <div class="custom-title">
        Estad√≠sticas de Publicaciones
    </div>
    <div class="description centered-text">
        <p>
            Esta secci√≥n presenta una recopilaci√≥n detallada de las publicaciones cient√≠ficas generadas por el CICIMA, reflejando el compromiso sostenido con la investigaci√≥n, el desarrollo y la innovaci√≥n en ciencia de materiales. Los datos se actualizan autom√°ticamente desde nuestra base de datos.
        </p>
    </div>
    <!-- Secci√≥n de estad√≠sticas principales -->
    <div class="stats-section">
        <h3>
            Resumen General
        </h3>
        <!-- Contenedor donde se cargar√°n din√°micamente las estad√≠sticas -->
        <div class="stats-grid" id="estadisticasPrincipales">
            <div class="stat-card">
                <div>
                    Cargando datos...
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 
    CELDA 4: GR√ÅFICOS DE PUBLICACIONES
    Contiene visualizaciones gr√°ficas interactivas de las publicaciones
-->
<div class="cell-container">
    <div class="custom-title">
        Gr√°ficos de Publicaciones
    </div>
    <div class="description centered-text">
        <p>
            Visualizaci√≥n gr√°fica de las publicaciones cient√≠ficas realizadas por el CICIMA y sus investigadores, mostrando la distribuci√≥n temporal y por tipo de publicaci√≥n. Seleccione un a√±o en el men√∫ desplegable para ver los detalles de las publicaciones de ese a√±o.
        </p>
    </div>
    <!-- Contenedor principal que divide en dos columnas: gr√°ficos y detalles -->
    <div class="charts-details-container">
        <!-- COLUMNA IZQUIERDA: GR√ÅFICOS VISUALES -->
        <div class="charts-column">
            <!-- Primer gr√°fico: Publicaciones por a√±o -->
            <div class="chart-wrapper">
                <h3>
                    Publicaciones por A√±o
                </h3>
                <div class="chart-container">
                    <!-- Canvas donde se dibujar√° el gr√°fico de barras con Chart.js -->
                    <canvas id="graficoBarras"></canvas>
                </div>
            </div>
            <!-- Segundo gr√°fico: Distribuci√≥n por tipo -->
            <div class="chart-wrapper">
                <h3>
                    Distribuci√≥n por Tipo
                </h3>
                <div class="chart-container">
                    <!-- Canvas donde se dibujar√° el gr√°fico de pastel con Chart.js -->
                    <canvas id="graficoPastel"></canvas>
                </div>
            </div>
        </div>
        
        <!-- COLUMNA DERECHA: SELECTOR Y DETALLES -->
        <div class="details-column">
            <div class="details-panel">
                <!-- Selector de a√±o para filtrar publicaciones -->
                <div class="selector-container">
                    <h3>
                        Detalles por A√±o
                    </h3>
                    <p>
                        <label for="selectorAnio">Seleccione un a√±o:</label> 
                        <select class="anio-selector" id="selectorAnio">
                            <!-- Las opciones se llenar√°n din√°micamente con JavaScript -->
                            <option value="">-- Todos los a√±os --</option>
                        </select>
                    </p>
                </div>
                
                <!-- BARRA DE B√öSQUEDA PARA FILTRAR PUBLICACIONES -->
                <div class="search-container">
                    <p>
                        <!-- Input de texto para buscar en t√≠tulos y autores -->
                        <input class="search-input" type="text" id="barraBusqueda" placeholder="Buscar por t√≠tulo o autor...">
                    </p>
                    <div class="search-info">
                        Buscar en t√≠tulos y autores
                    </div>
                </div>
                
                <!-- CONTENEDOR CON SCROLL PARA LA TABLA DE DETALLES -->
                <div class="table-scroll-container">
                    <!-- Tabla que muestra los detalles de las publicaciones -->
                    <table id="tablaDetalles">
                        <thead>
                            <tr>
                                <th>
                                    <p>
                                        T√≠tulo
                                    </p>
                                </th>
                                <th>
                                    <p>
                                        Autores
                                    </p>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se llenar√°n din√°micamente con JavaScript -->
                            &nbsp;
                        </tbody>
                    </table>
                </div>
                
                <!-- Pie de p√°gina con contador de resultados -->
                <div class="detalles-footer">
                    <p id="contadorDetalles">
                        Cargando publicaciones...
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 
    ============================================================
    SECCI√ìN DE ESTILOS CSS
    ============================================================
    Define la apariencia visual de todos los elementos de la p√°gina
-->
<style>
    /* 
        ESTILO BASE PARA CONTENEDORES DE CELDAS
        Crea el efecto de tarjetas con sombras y bordes redondeados
    */
    .cell-container {
        background-color: white; /* Fondo blanco para contraste */
        border-radius: 20px; /* Esquinas redondeadas */
        padding: 20px; /* Espacio interno */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Sombra sutil para efecto de elevaci√≥n */
        margin: 20px auto; /* Centrado con m√°rgenes autom√°ticos */
        max-width: 1200px; /* Ancho m√°ximo para pantallas grandes */
    }

    /* 
        ESTILO PARA T√çTULOS PERSONALIZADOS
        T√≠tulos centrados con formato destacado
    */
    .custom-title {
        text-align: center; /* Centrado horizontal */
        font-size: 24px; /* Tama√±o de fuente grande */
        font-weight: bold; /* Texto en negrita */
        margin-bottom: 10px; /* Espacio inferior */
        color: #333; /* Color gris oscuro */
    }

    /* 
        ESTILO BASE PARA DESCRIPCIONES
        Texto justificado por defecto
    */
    .description {
        color: #000; /* Color negro para texto */
        text-align: justify; /* Texto justificado */
    }

    /* 
        CLASE PARA TEXTO CENTRADO
        Modificador para centrar texto en lugar de justificar
    */
    .centered-text {
        text-align: center; /* Centrado horizontal */
    }

    /* 
        ESTILO PARA LISTAS NO ORDENADAS
        Indentaci√≥n y alineaci√≥n espec√≠fica
    */
    .description ul {
        margin-left: 20px; /* Sangr√≠a izquierda */
        text-align: left; /* Alineaci√≥n izquierda (anula el justify) */
    }

    /* 
        ESTILO PARA ENCABEZADOS DE NIVEL 3
        Encabezados con espaciado y color espec√≠fico
    */
    .description h3 {
        margin-top: 30px; /* Espacio superior grande */
        margin-bottom: 10px; /* Espacio inferior */
        color: #333; /* Color gris oscuro */
    }

    /* 
        CONTENEDOR PARA BOTONES
        Centra los botones horizontalmente
    */
    .button-container {
        text-align: center; /* Centrado horizontal */
        margin-top: 30px; /* Espacio superior */
    }

    /* 
        ESTILO BASE PARA BOTONES
        Dise√±o moderno con transiciones suaves
    */
    .button {
        display: inline-block; /* Permite padding y m√°rgenes */
        padding: 12px 25px; /* Espacio interno generoso */
        font-size: 18px; /* Tama√±o de fuente legible */
        color: white; /* Texto blanco para contraste */
        text-decoration: none; /* Sin subrayado */
        border-radius: 20px; /* Esquinas muy redondeadas */
        cursor: pointer; /* Cursor de mano al pasar */
        background-color: #008CBA; /* Color azul por defecto */
        transition: background-color 0.3s, opacity 0.3s; /* Transiciones suaves */
        border: none; /* Sin borde */
        margin: 5px; /* Separaci√≥n entre botones */
    }

    /* 
        EFECTO HOVER PARA BOTONES
        Cambio visual al pasar el mouse
    */
    .button:hover {
        opacity: 0.85; /* Ligera transparencia */
    }

    /* 
        VARIANTE DE BOT√ìN AZUL
        Clase espec√≠fica para botones azules
    */
    .btn-blue {
        background-color: #008CBA; /* Color azul caracter√≠stico */
    }

    /* 
        VARIANTE DE BOT√ìN VERDE
        Clase espec√≠fica para botones verdes (no utilizada en este c√≥digo)
    */
    .btn-green {
        background-color: #4CAF50; /* Color verde */
    }
    
    /* 
        ESTILOS PARA LA SECCI√ìN DE ESTAD√çSTICAS
        Dise√±o de tarjetas con gradientes y efectos hover
    */
    .stats-section {
        margin: 30px 0; /* Espacio vertical */
    }
    
    /* Encabezado de secci√≥n de estad√≠sticas */
    .stats-section h3 {
        color: #333; /* Color gris oscuro */
        border-bottom: 2px solid #008CBA; /* L√≠nea inferior azul */
        padding-bottom: 10px; /* Espacio entre texto y l√≠nea */
        margin-bottom: 20px; /* Espacio inferior */
    }
    
    /* 
        CUADRICULA DE ESTAD√çSTICAS
        Dise√±o responsive con CSS Grid
    */
    .stats-grid {
        display: grid; /* Usa CSS Grid para layout */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Columnas responsive */
        gap: 15px; /* Espacio entre elementos */
        margin: 20px 0; /* Espacio vertical */
    }
    
    /* 
        TARJETAS DE ESTAD√çSTICAS INDIVIDUALES
        Dise√±o atractivo con gradientes y efectos
    */
    .stat-card {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); /* Gradiente azul */
        color: white; /* Texto blanco */
        padding: 20px; /* Espacio interno */
        border-radius: 8px; /* Esquinas redondeadas */
        text-align: center; /* Texto centrado */
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* Sombra sutil */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* Transiciones suaves */
    }
    
    /* 
        EFECTO HOVER PARA TARJETAS DE ESTAD√çSTICAS
        Elevaci√≥n y sombra m√°s pronunciada al pasar el mouse
    */
    .stat-card:hover {
        transform: translateY(-5px); /* Efecto de elevaci√≥n */
        box-shadow: 0 8px 15px rgba(0,0,0,0.2); /* Sombra m√°s pronunciada */
    }
    
    /* 
        N√öMEROS DE ESTAD√çSTICAS
        Estilo para n√∫meros grandes y destacados
    */
    .stat-number {
        font-size: 2em; /* Tama√±o de fuente muy grande */
        font-weight: bold; /* Texto en negrita */
        margin: 10px 0; /* Espacio vertical */
    }
    
    /* 
        CONTENEDOR PRINCIPAL DE GR√ÅFICOS Y DETALLES
        Dise√±o de dos columnas usando CSS Grid
    */
    .charts-details-container {
        display: grid; /* Usa CSS Grid */
        grid-template-columns: 2fr 1fr; /* Dos columnas: gr√°ficos m√°s ancha, detalles m√°s estrecha */
        gap: 30px; /* Espacio entre columnas */
        margin: 30px 0; /* Espacio vertical */
    }
    
    /* 
        COLUMNA DE GR√ÅFICOS
        Dise√±o en columna para apilar los gr√°ficos verticalmente
    */
    .charts-column {
        display: flex; /* Usa Flexbox para alineaci√≥n */
        flex-direction: column; /* Elementos en columna */
        gap: 30px; /* Espacio entre gr√°ficos */
    }
    
    /* 
        COLUMNA DE DETALLES
        Tambi√©n usa Flexbox para organizaci√≥n vertical
    */
    .details-column {
        display: flex; /* Usa Flexbox */
        flex-direction: column; /* Elementos en columna */
    }
    
    /* 
        CONTENEDOR DE GR√ÅFICOS INDIVIDUALES
        Fondo y bordes para separar visualmente cada gr√°fico
    */
    .chart-wrapper {
        background: #f8f9fa; /* Fondo gris muy claro */
        padding: 20px; /* Espacio interno */
        border-radius: 10px; /* Esquinas redondeadas */
        border: 1px solid #e9ecef; /* Borde sutil */
    }
    
    /* 
        CONTENEDOR PARA LOS CANVAS DE GR√ÅFICOS
        Controla la altura y posici√≥n de los gr√°ficos
    */
    .chart-container {
        position: relative; /* Posicionamiento relativo para elementos hijos */
        height: 300px; /* Altura fija para consistencia */
        margin: 15px 0; /* Espacio vertical */
    }
    
    /* 
        MENSAJE CUANDO NO HAY DATOS
        Estilo para mensajes de datos no disponibles
    */
    .no-data-message {
        text-align: center; /* Texto centrado */
        color: #666; /* Color gris */
        font-style: italic; /* Texto en cursiva */
        padding: 40px 0; /* Espacio vertical generoso */
    }
    
    /* 
        PANEL DE DETALLES
        Dise√±o del panel lateral con informaci√≥n detallada
    */
    .details-panel {
        background: #f8f9fa; /* Fondo gris muy claro */
        padding: 20px; /* Espacio interno */
        border-radius: 10px; /* Esquinas redondeadas */
        border: 1px solid #e9ecef; /* Borde sutil */
        height: 100%; /* Ocupa toda la altura disponible */
        display: flex; /* Usa Flexbox */
        flex-direction: column; /* Elementos en columna */
        min-height: 600px; /* Altura m√≠nima para buena visualizaci√≥n */
    }
    
    /* 
        CONTENEDOR DEL SELECTOR DE A√ëO
        Estilo para el √°rea del selector
    */
    .selector-container {
        margin-bottom: 20px; /* Espacio inferior */
        flex-shrink: 0; /* Evita que se encoja en layouts flex */
    }
    
    /* Encabezado del selector */
    .selector-container h3 {
        margin-top: 0; /* Sin margen superior */
        color: #333; /* Color gris oscuro */
        border-bottom: 2px solid #008CBA; /* L√≠nea inferior azul */
        padding-bottom: 10px; /* Espacio entre texto y l√≠nea */
        margin-bottom: 15px; /* Espacio inferior */
    }
    
    /* Etiqueta del selector */
    .selector-container label {
        display: block; /* Ocupa toda la l√≠nea */
        margin-bottom: 8px; /* Espacio inferior */
        font-weight: bold; /* Texto en negrita */
        color: #333; /* Color gris oscuro */
    }
    
    /* 
        SELECTOR DE A√ëO (dropdown)
        Estilo personalizado para el elemento select
    */
    .anio-selector {
        width: 100%; /* Ancho completo */
        padding: 10px; /* Espacio interno */
        border: 1px solid #ddd; /* Borde gris claro */
        border-radius: 5px; /* Esquinas ligeramente redondeadas */
        background-color: white; /* Fondo blanco */
        font-size: 16px; /* Tama√±o de fuente legible */
    }
    
    /* 
        ESTADO DE FOCO PARA EL SELECTOR
        Cambio visual cuando el selector est√° activo
    */
    .anio-selector:focus {
        outline: none; /* Elimina el outline por defecto */
        border-color: #008CBA; /* Borde azul */
        box-shadow: 0 0 0 2px rgba(0, 140, 186, 0.2); /* Sombra azul sutil */
    }
    
    /* 
        CONTENEDOR DE B√öSQUEDA
        Estilo para el √°rea de b√∫squeda
    */
    .search-container {
        margin-bottom: 15px; /* Espacio inferior */
        flex-shrink: 0; /* Evita que se encoja en layouts flex */
    }
    
    /* 
        CAMPO DE B√öSQUEDA
        Estilo personalizado para el input de texto
    */
    .search-input {
        width: 100%; /* Ancho completo */
        padding: 10px; /* Espacio interno */
        border: 1px solid #ddd; /* Borde gris claro */
        border-radius: 5px; /* Esquinas ligeramente redondeadas */
        background-color: white; /* Fondo blanco */
        font-size: 16px; /* Tama√±o de fuente legible */
        box-sizing: border-box; /* Incluye padding en el ancho total */
    }
    
    /* 
        ESTADO DE FOCO PARA EL CAMPO DE B√öSQUEDA
        Cambio visual cuando el campo est√° activo
    */
    .search-input:focus {
        outline: none; /* Elimina el outline por defecto */
        border-color: #008CBA; /* Borde azul */
        box-shadow: 0 0 0 2px rgba(0, 140, 186, 0.2); /* Sombra azul sutil */
    }
    
    /* 
        INFORMACI√ìN DE B√öSQUEDA
        Texto peque√±o con instrucciones
    */
    .search-info {
        font-size: 0.8em; /* Tama√±o de fuente peque√±o */
        color: #666; /* Color gris */
        margin-top: 5px; /* Espacio superior */
    }
    
    /* 
        CONTENEDOR CON SCROLL PARA LA TABLA
        Permite scroll vertical cuando hay muchos datos
    */
    .table-scroll-container {
        flex: 1; /* Ocupa el espacio disponible restante */
        overflow-y: auto; /* Scroll vertical cuando sea necesario */
        border: 1px solid #e9ecef; /* Borde sutil */
        border-radius: 8px; /* Esquinas redondeadas */
        background: white; /* Fondo blanco */
        margin-bottom: 15px; /* Espacio inferior */
        max-height: 400px; /* Altura m√°xima antes de mostrar scroll */
    }
    
    /* 
        ESTILO PARA TABLAS
        Dise√±o limpio y moderno para tablas de datos
    */
    table {
        width: 100%; /* Ancho completo */
        border-collapse: collapse; /* Elimina espacios entre bordes */
    }
    
    /* 
        CELDAS DE TABLA (encabezados y datos)
        Espaciado y bordes para mejor legibilidad
    */
    th, td {
        padding: 12px 15px; /* Espacio interno generoso */
        text-align: left; /* Alineaci√≥n izquierda */
        border-bottom: 1px solid #e9ecef; /* L√≠nea separadora */
    }
    
    /* 
        ENCABEZADOS DE TABLA
        Estilo destacado con posici√≥n sticky
    */
    th {
        background-color: #f8f9fa; /* Fondo gris claro */
        position: sticky; /* Se mantiene visible al hacer scroll */
        top: 0; /* Posici√≥n en la parte superior */
        z-index: 10; /* Por encima del contenido */
        font-weight: bold; /* Texto en negrita */
        color: #333; /* Color gris oscuro */
    }
    
    /* 
        EFECTO HOVER PARA FILAS DE TABLA
        Resalta la fila bajo la que est√° el cursor
    */
    tr:hover {
        background-color: #f5f5f5; /* Fondo gris muy claro */
    }
    
    /* 
        PIE DE DETALLES
        Informaci√≥n del contador de resultados
    */
    .detalles-footer {
        text-align: center; /* Texto centrado */
        color: #666; /* Color gris */
        font-style: italic; /* Texto en cursiva */
        margin-top: 10px; /* Espacio superior */
        flex-shrink: 0; /* Evita que se encoja en layouts flex */
    }
    
    /* 
        MEDIA QUERY PARA DISPOSITIVOS DE ESCRITORIO MEDIANOS (1024px)
        Ajustes responsive para tablets grandes
    */
    @media (max-width: 1024px) {
        .charts-details-container {
            grid-template-columns: 1fr; /* Una sola columna en lugar de dos */
            gap: 20px; /* Menor espacio entre elementos */
        }
        
        .charts-column {
            gap: 20px; /* Menor espacio entre gr√°ficos */
        }
        
        .chart-container {
            height: 250px; /* Altura reducida para gr√°ficos */
        }
        
        .details-panel {
            min-height: 500px; /* Altura m√≠nima reducida */
        }
        
        .table-scroll-container {
            max-height: 350px; /* Altura m√°xima reducida */
        }
    }
    
    /* 
        MEDIA QUERY PARA DISPOSITIVOS M√ìVILES (768px)
        Ajustes responsive para tablets y tel√©fonos
    */
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Columnas m√°s estrechas */
        }
        
        .chart-container {
            height: 200px; /* Altura a√∫n m√°s reducida */
        }
        
        .details-panel {
            min-height: 450px; /* Altura m√≠nima a√∫n m√°s reducida */
        }
        
        .table-scroll-container {
            max-height: 300px; /* Altura m√°xima a√∫n m√°s reducida */
        }
        
        th, td {
            padding: 8px 10px; /* Espaciado reducido */
            font-size: 0.9em; /* Tama√±o de fuente reducido */
        }
    }
</style>

<!-- 
    ============================================================
    SECCI√ìN DE JAVASCRIPT
    ============================================================
    C√≥digo para cargar datos, generar gr√°ficos y manejar interacciones
-->

<!-- 
    INCLUSI√ìN DE BIBLIOTECAS EXTERNAS
    - PapaParse: Para procesar archivos CSV
    - Chart.js: Para crear gr√°ficos interactivos
-->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- 
    C√ìDIGO JAVASCRIPT PRINCIPAL
    Maneja la l√≥gica de la aplicaci√≥n
-->
<script>
    // ===== CONFIGURACI√ìN PRINCIPAL =====
    // URL directa a la hoja de Google Sheets publicada (formato CSV)
    const URL_OPTIONS = [
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vT_kiwTiz9yAtvMzZpp6V3KvtPj3gT4CSsaj7GKSu68VgL6taokqEbobqTMN5YcgN0qm17ViycLj4IS/pub?gid=975984200&single=true&output=csv'
    ];
    
    // ===== VARIABLES GLOBALES =====
    let datosActuales = []; // Almacena todos los datos cargados
    let currentUrlIndex = 0; // √çndice de la URL actual (para reintentos)
    let isLoading = false; // Bandera para evitar cargas simult√°neas
    let columnaAnioSeleccionada = ''; // Nombre de la columna que contiene los a√±os
    let columnaTipoSeleccionada = ''; // Nombre de la columna que contiene los tipos
    let columnaTituloSeleccionada = ''; // Nombre de la columna que contiene los t√≠tulos
    let columnaAutoresSeleccionada = ''; // Nombre de la columna que contiene los autores
    let chartBarras = null; // Referencia al gr√°fico de barras
    let chartPastel = null; // Referencia al gr√°fico de pastel
    let aniosDisponibles = []; // Lista de a√±os disponibles en los datos
    let publicacionesFiltradas = []; // Publicaciones filtradas seg√∫n selecci√≥n actual
    let anioSeleccionadoActual = ''; // A√±o seleccionado actualmente
    
    // ===== FUNCIONES PRINCIPALES =====
    
    /**
     * Funci√≥n principal para cargar datos desde Google Sheets
     * Utiliza fetch para obtener el CSV y PapaParse para procesarlo
     */
    async function cargarDatos() {
        // Evitar m√∫ltiples cargas simult√°neas
        if (isLoading) {
            console.log('Ya hay una carga en progreso, ignorando nueva solicitud');
            return;
        }
        
        isLoading = true;
        mostrarEstadoCarga('Cargando datos...');
        
        try {
            console.log(`Iniciando carga de datos. URL actual: ${currentUrlIndex}`);
            
            // Realizar petici√≥n HTTP para obtener el CSV
            const response = await fetch(URL_OPTIONS[currentUrlIndex], {
                method: 'GET',
                headers: {
                    'Content-Type': 'text/csv'
                },
                cache: 'no-cache' // Evitar cach√© para obtener datos frescos
            });
            
            console.log(`Respuesta recibida: ${response.status} ${response.statusText}`);
            
            // Verificar si la respuesta es exitosa
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
            }
            
            // Obtener el texto CSV
            const csvText = await response.text();
            console.log(`Datos CSV recibidos (${csvText.length} caracteres)`);
            
            // Verificar que el CSV no est√© vac√≠o
            if (!csvText || csvText.trim() === '') {
                throw new Error('El archivo CSV est√° vac√≠o');
            }
            
            console.log('Iniciando an√°lisis del CSV con PapaParse');
            
            // Parsear el CSV usando PapaParse
            return new Promise((resolve, reject) => {
                Papa.parse(csvText, {
                    header: true, // Primera fila como nombres de columnas
                    dynamicTyping: true, // Convertir n√∫meros y booleanos autom√°ticamente
                    skipEmptyLines: true, // Saltar l√≠neas vac√≠as
                    complete: function(resultados) {
                        console.log(`An√°lisis completado. ${resultados.data.length} filas procesadas`);
                        
                        // Verificar errores de parsing
                        if (resultados.errors.length > 0) {
                            console.error('Errores en el an√°lisis:', resultados.errors);
                            reject(new Error('Error al procesar los datos: ' + resultados.errors[0].message));
                            return;
                        }
                        
                        // Filtrar filas completamente vac√≠as
                        datosActuales = resultados.data.filter(fila => 
                            Object.values(fila).some(valor => valor !== null && valor !== '')
                        );
                        
                        console.log(`‚úÖ ${datosActuales.length} registros v√°lidos encontrados`);
                        
                        // Procesar datos si hay registros v√°lidos
                        if (datosActuales.length > 0) {
                            // Obtener nombres de columnas disponibles
                            const columnasDisponibles = Object.keys(datosActuales[0]);
                            console.log('Columnas detectadas:', columnasDisponibles);
                            
                            // Detectar autom√°ticamente qu√© columnas contienen qu√© informaci√≥n
                            detectarColumnasAutomaticamente(columnasDisponibles);
                            
                            // Actualizar todos los componentes de la interfaz
                            actualizarEstadisticas();
                            actualizarGraficos();
                            actualizarSelectorAnios();
                            
                            // Mostrar todas las publicaciones inicialmente
                            mostrarTodasLasPublicaciones();
                            
                            // Quitar mensaje de carga
                            mostrarEstadoCarga('', false);
                        } else {
                            mostrarEstadoCarga('No se encontraron datos v√°lidos en el archivo');
                        }
                        
                        resolve(datosActuales);
                    },
                    error: function(error) {
                        console.error('Error en PapaParse:', error);
                        reject(new Error('Error al procesar el formato del archivo: ' + error.message));
                    }
                });
            });
            
        } catch (error) {
            console.error('‚ùå Error en la carga:', error);
            
            // ESTRATEGIA DE REINTENTO: Intentar con URL alternativa si hay error
            if (currentUrlIndex < URL_OPTIONS.length - 1) {
                currentUrlIndex++;
                console.log(`üîÑ Intentando con URL alternativa: ${currentUrlIndex}`);
                
                // Peque√±a pausa antes de reintentar
                setTimeout(() => {
                    cargarDatos();
                }, 1000);
                return;
            } else {
                // Si fallan todos los intentos, mostrar error al usuario
                mostrarError('No se pudieron cargar los datos despu√©s de intentar todas las URLs.<br>' +
                           'Posibles causas:<br>' +
                           '1. La hoja no est√° publicada correctamente<br>' +
                           '2. Problemas de CORS<br>' +
                           '3. L√≠mites de frecuencia en los proxies<br><br>' +
                           '<a href="https://docs.google.com/spreadsheets/d/' + SHEET_ID + '/edit" target="_blank">Verificar hoja</a>');
            }
        } finally {
            isLoading = false;
        }
    }
    
    /**
     * Detecta autom√°ticamente qu√© columnas contienen a√±os, tipos, t√≠tulos y autores
     * bas√°ndose en nombres comunes de columnas
     */
    function detectarColumnasAutomaticamente(columnasDisponibles) {
        // Buscar columnas que puedan contener a√±os
        const posiblesColumnasAnio = columnasDisponibles.filter(col => 
            col.toLowerCase().includes('a√±o') || 
            col.toLowerCase().includes('year') ||
            col.toLowerCase().includes('fecha') ||
            col.toLowerCase().includes('date')
        );
        
        if (posiblesColumnasAnio.length > 0 && !columnaAnioSeleccionada) {
            columnaAnioSeleccionada = posiblesColumnasAnio[0];
            console.log(`Columna de a√±o detectada autom√°ticamente: ${columnaAnioSeleccionada}`);
        }
        
        // Buscar columnas que puedan contener tipos
        const posiblesColumnasTipo = columnasDisponibles.filter(col => 
            col.toLowerCase().includes('tipo') || 
            col.toLowerCase().includes('type') ||
            col.toLowerCase().includes('categor√≠a') ||
            col.toLowerCase().includes('category') ||
            col.toLowerCase().includes('clasificaci√≥n')
        );
        
        if (posiblesColumnasTipo.length > 0 && !columnaTipoSeleccionada) {
            columnaTipoSeleccionada = posiblesColumnasTipo[0];
            console.log(`Columna de tipo detectada autom√°ticamente: ${columnaTipoSeleccionada}`);
        }
        
        // Buscar columnas que puedan contener t√≠tulos
        const posiblesColumnasTitulo = columnasDisponibles.filter(col => 
            col.toLowerCase().includes('t√≠tulo') || 
            col.toLowerCase().includes('titulo') ||
            col.toLowerCase().includes('title') ||
            col.toLowerCase().includes('nombre') ||
            col.toLowerCase().includes('name')
        );
        
        if (posiblesColumnasTitulo.length > 0 && !columnaTituloSeleccionada) {
            columnaTituloSeleccionada = posiblesColumnasTitulo[0];
            console.log(`Columna de t√≠tulo detectada autom√°ticamente: ${columnaTituloSeleccionada}`);
        }
        
        // Buscar columnas que puedan contener autores
        const posiblesColumnasAutores = columnasDisponibles.filter(col => 
            col.toLowerCase().includes('autor') || 
            col.toLowerCase().includes('author') ||
            col.toLowerCase().includes('autores') ||
            col.toLowerCase().includes('authors')
        );
        
        if (posiblesColumnasAutores.length > 0 && !columnaAutoresSeleccionada) {
            columnaAutoresSeleccionada = posiblesColumnasAutores[0];
            console.log(`Columna de autores detectada autom√°ticamente: ${columnaAutoresSeleccionada}`);
        }
        
        // Si no se detect√≥ autom√°ticamente, usar las primeras columnas disponibles como fallback
        if (!columnaAnioSeleccionada && columnasDisponibles.length > 0) {
            columnaAnioSeleccionada = columnasDisponibles[0];
        }
        
        if (!columnaTipoSeleccionada && columnasDisponibles.length > 1) {
            columnaTipoSeleccionada = columnasDisponibles[1];
        }
        
        if (!columnaTituloSeleccionada && columnasDisponibles.length > 2) {
            columnaTituloSeleccionada = columnasDisponibles[2];
        }
        
        if (!columnaAutoresSeleccionada && columnasDisponibles.length > 3) {
            columnaAutoresSeleccionada = columnasDisponibles[3];
        }
    }
    
    /**
     * Muestra mensajes de estado durante la carga de datos
     */
    function mostrarEstadoCarga(mensaje, esCarga = true) {
        const container = document.getElementById('estadisticasPrincipales');
        
        if (esCarga) {
            container.innerHTML = `
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div>
                        ${mensaje}
                    </div>
                    <div style="font-size: 0.9em; margin-top: 10px;">
                        Por favor espere...
                    </div>
                </div>
            `;
        } else if (mensaje) {
            container.innerHTML = `
                <div class="stat-card" style="grid-column: 1 / -1; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);">
                    <div>
                        ${mensaje}
                    </div>
                </div>
            `;
        }
    }
    
    /**
     * Muestra mensajes de error al usuario
     */
    function mostrarError(mensaje) {
        document.getElementById('estadisticasPrincipales').innerHTML = `
            <div class="stat-card" style="grid-column: 1 / -1; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);">
                <div>
                    Error de Conexi√≥n
                </div>
                <div style="font-size: 0.9em; margin-top: 10px;">
                    ${mensaje}
                </div>
                <div style="font-size: 0.8em; margin-top: 15px;">
                    <strong>Para solucionar:</strong><br>
                    1. Verifica que la hoja est√© publicada correctamente<br>
                    2. Aseg√∫rate de que est√© compartida como "Cualquier persona con el enlace"<br>
                    3. Intenta recargar la p√°gina
                </div>
            </div>
        `;
    }
    
    // ===== FUNCIONES DE AN√ÅLISIS DE DATOS =====
    
    /**
     * Calcula estad√≠sticas generales a partir de los datos cargados
     * @returns {Object} Objeto con estad√≠sticas calculadas
     */
    function calcularEstadisticas() {
        if (datosActuales.length === 0) return {};
        
        const stats = {
            totalRegistros: datosActuales.length,
            publicacionesPorAnio: {},
            publicacionesPorTipo: {},
            a√±osUnicos: new Set(),
            tiposUnicos: new Set()
        };
        
        // Analizar cada fila de datos
        datosActuales.forEach(fila => {
            // Obtener a√±o de la columna seleccionada
            let a√±o = null;
            if (columnaAnioSeleccionada && fila[columnaAnioSeleccionada]) {
                a√±o = fila[columnaAnioSeleccionada];
            }
            
            // Contar publicaciones por a√±o
            if (a√±o && !isNaN(a√±o)) {
                const a√±oNum = parseInt(a√±o);
                stats.publicacionesPorAnio[a√±oNum] = (stats.publicacionesPorAnio[a√±oNum] || 0) + 1;
                stats.a√±osUnicos.add(a√±oNum);
            }
            
            // Obtener tipo de la columna seleccionada
            let tipo = null;
            if (columnaTipoSeleccionada && fila[columnaTipoSeleccionada]) {
                tipo = fila[columnaTipoSeleccionada];
            }
            
            // Contar publicaciones por tipo
            if (tipo) {
                const tipoStr = tipo.toString().trim();
                if (tipoStr) {
                    stats.publicacionesPorTipo[tipoStr] = (stats.publicacionesPorTipo[tipoStr] || 0) + 1;
                    stats.tiposUnicos.add(tipoStr);
                }
            }
        });
        
        return stats;
    }
    
    // ===== FUNCIONES DE ACTUALIZACI√ìN DE INTERFAZ =====
    
    /**
     * Actualiza las tarjetas de estad√≠sticas en la interfaz
     */
    function actualizarEstadisticas() {
        const stats = calcularEstadisticas();
        const container = document.getElementById('estadisticasPrincipales');
        
        // Mostrar mensaje si no hay datos
        if (datosActuales.length === 0) {
            container.innerHTML = `
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div>
                        No hay datos disponibles
                    </div>
                    <div style="font-size: 0.9em; margin-top: 10px;">
                        El archivo no contiene registros v√°lidos
                    </div>
                </div>
            `;
            return;
        }
        
        // Calcular rango temporal
        const a√±os = Object.keys(stats.publicacionesPorAnio);
        const a√±oMin = a√±os.length > 0 ? Math.min(...a√±os) : 'N/A';
        const a√±oMax = a√±os.length > 0 ? Math.max(...a√±os) : 'N/A';
        
        // Actualizar HTML con las estad√≠sticas calculadas
        container.innerHTML = `
            <div class="stat-card">
                <div>
                    Total Publicaciones
                </div>
                <div class="stat-number">
                    ${stats.totalRegistros}
                </div>
                <div>
                    registros cient√≠ficos
                </div>
            </div>
            <div class="stat-card">
                <div>
                    Rango Temporal
                </div>
                <div class="stat-number">
                    ${a√±oMin}-${a√±oMax}
                </div>
                <div>
                    ${a√±os.length} a√±os diferentes
                </div>
            </div>
            <div class="stat-card">
                <div>
                    Tipos de Publicaci√≥n
                </div>
                <div class="stat-number">
                    ${stats.tiposUnicos.size}
                </div>
                <div>
                    categor√≠as distintas
                </div>
            </div>
            <div class="stat-card">
                <div>
                    Publicaci√≥n M√°s Reciente
                </div>
                <div class="stat-number">
                    ${a√±oMax}
                </div>
                <div>
                    a√±o actual
                </div>
            </div>
        `;
    }
    
    /**
     * Actualiza los gr√°ficos con los datos actuales
     */
    function actualizarGraficos() {
        const stats = calcularEstadisticas();
        
        // GR√ÅFICO DE BARRAS - Publicaciones por a√±o
        const canvasBarras = document.getElementById('graficoBarras');
        
        // Verificar si el canvas existe
        if (!canvasBarras) {
            console.error('No se encontr√≥ el elemento canvas para el gr√°fico de barras');
            return;
        }
        
        const ctxBarras = canvasBarras.getContext('2d');
        
        // Destruir gr√°fico anterior si existe
        if (chartBarras) {
            chartBarras.destroy();
        }
        
        // Preparar datos para el gr√°fico de barras
        aniosDisponibles = Object.keys(stats.publicacionesPorAnio).sort((a, b) => a - b);
        const conteosAnios = aniosDisponibles.map(anio => stats.publicacionesPorAnio[anio]);
        
        console.log('Datos para gr√°fico de barras (a√±os):', aniosDisponibles, conteosAnios);
        
        // Crear gr√°fico de barras si hay datos
        if (aniosDisponibles.length > 0 && conteosAnios.length > 0) {
            chartBarras = new Chart(ctxBarras, {
                type: 'bar',
                data: {
                    labels: aniosDisponibles,
                    datasets: [{
                        label: 'N√∫mero de Publicaciones',
                        data: conteosAnios,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(54, 162, 235, 0.9)',
                        hoverBorderColor: 'rgba(54, 162, 235, 1)',
                        hoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Publicaciones'
                            },
                            ticks: {
                                precision: 0 // Mostrar solo n√∫meros enteros
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'A√±o'
                            }
                        }
                    }
                }
            });
        } else {
            // Mostrar mensaje si no hay datos
            const parent = canvasBarras.parentNode;
            parent.innerHTML = '<div class="no-data-message">No hay datos de a√±os para mostrar. Verifique la configuraci√≥n de columnas.</div>';
        }
        
        // GR√ÅFICO DE PASTEL - Distribuci√≥n por tipo
        const canvasPastel = document.getElementById('graficoPastel');
        
        // Verificar si el canvas existe
        if (!canvasPastel) {
            console.error('No se encontr√≥ el elemento canvas para el gr√°fico de pastel');
            return;
        }
        
        const ctxPastel = canvasPastel.getContext('2d');
        
        // Destruir gr√°fico anterior si existe
        if (chartPastel) {
            chartPastel.destroy();
        }
        
        // Preparar datos para el gr√°fico de pastel
        const tipos = Object.keys(stats.publicacionesPorTipo);
        
        // Ordenar tipos por cantidad (de mayor a menor) y tomar solo los primeros 8
        const tiposOrdenados = tipos.sort((a, b) => stats.publicacionesPorTipo[b] - stats.publicacionesPorTipo[a]);
        const conteosTipos = tiposOrdenados.map(tipo => stats.publicacionesPorTipo[tipo]);
        
        console.log('Datos para gr√°fico de pastel (tipos):', tiposOrdenados, conteosTipos);
        
        // Crear gr√°fico de pastel si hay datos
        if (tiposOrdenados.length > 0 && conteosTipos.length > 0) {
            // Colores para el gr√°fico de pastel
            const colores = [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(199, 199, 199, 0.7)',
                'rgba(83, 102, 255, 0.7)',
                'rgba(40, 159, 64, 0.7)',
                'rgba(210, 99, 132, 0.7)'
            ];
            
            chartPastel = new Chart(ctxPastel, {
                type: 'pie',
                data: {
                    labels: tiposOrdenados,
                    datasets: [{
                        data: conteosTipos,
                        backgroundColor: colores.slice(0, tiposOrdenados.length),
                        borderColor: colores.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        } else {
            // Mostrar mensaje si no hay datos
            const parent = canvasPastel.parentNode;
            parent.innerHTML = '<div class="no-data-message">No hay datos de tipos para mostrar. Verifique la configuraci√≥n de columnas.</div>';
        }
    }
    
    /**
     * Actualiza el selector de a√±os con los a√±os disponibles
     */
    function actualizarSelectorAnios() {
        const selector = document.getElementById('selectorAnio');
        const stats = calcularEstadisticas();
        
        // Limpiar selector (manteniendo la opci√≥n "Todos los a√±os")
        selector.innerHTML = '<option value="">-- Todos los a√±os --</option>';
        
        // Obtener a√±os ordenados (m√°s recientes primero)
        const a√±os = Object.keys(stats.publicacionesPorAnio).sort((a, b) => b - a);
        
        // A√±adir opciones al selector
        a√±os.forEach(a√±o => {
            const option = document.createElement('option');
            option.value = a√±o;
            option.textContent = `${a√±o} (${stats.publicacionesPorAnio[a√±o]} publicaciones)`;
            selector.appendChild(option);
        });
        
        console.log('Selector de a√±os actualizado con', a√±os.length, 'a√±os');
    }
    
    // ===== FUNCIONES PARA DETALLES Y B√öSQUEDA =====
    
    /**
     * Muestra todas las publicaciones sin filtrar por a√±o
     */
    function mostrarTodasLasPublicaciones() {
        anioSeleccionadoActual = '';
        publicacionesFiltradas = [...datosActuales]; // Copia de todos los datos
        
        // Aplicar b√∫squeda si hay texto en la barra de b√∫squeda
        const textoBusqueda = document.getElementById('barraBusqueda').value;
        if (textoBusqueda) {
            aplicarBusqueda(textoBusqueda);
        } else {
            actualizarTablaDetalles(publicacionesFiltradas);
        }
    }
    
    /**
     * Filtra y muestra publicaciones de un a√±o espec√≠fico
     * @param {string} anio - A√±o a filtrar
     */
    function mostrarDetallesAnio(anio) {
        anioSeleccionadoActual = anio;
        
        // Filtrar publicaciones del a√±o seleccionado
        publicacionesFiltradas = datosActuales.filter(fila => {
            let a√±oFila = null;
            if (columnaAnioSeleccionada && fila[columnaAnioSeleccionada]) {
                a√±oFila = parseInt(fila[columnaAnioSeleccionada]);
            }
            return a√±oFila === parseInt(anio);
        });
        
        // Aplicar b√∫squeda si hay texto en la barra de b√∫squeda
        const textoBusqueda = document.getElementById('barraBusqueda').value;
        if (textoBusqueda) {
            aplicarBusqueda(textoBusqueda);
        } else {
            actualizarTablaDetalles(publicacionesFiltradas);
        }
    }
    
    /**
     * Filtra publicaciones por texto de b√∫squeda
     * @param {string} texto - Texto a buscar en t√≠tulos y autores
     */
    function aplicarBusqueda(texto) {
        const textoMinusculas = texto.toLowerCase().trim();
        
        // Si no hay texto de b√∫squeda, mostrar todas las publicaciones seg√∫n el filtro actual
        if (textoMinusculas === '') {
            actualizarTablaDetalles(publicacionesFiltradas);
            return;
        }
        
        // Filtrar publicaciones por texto de b√∫squeda
        const resultados = publicacionesFiltradas.filter(publicacion => {
            const titulo = columnaTituloSeleccionada ? 
                (publicacion[columnaTituloSeleccionada] || '').toString().toLowerCase() : '';
            const autores = columnaAutoresSeleccionada ? 
                (publicacion[columnaAutoresSeleccionada] || '').toString().toLowerCase() : '';
            
            // Buscar en t√≠tulo y autores
            return titulo.includes(textoMinusculas) || autores.includes(textoMinusculas);
        });
        
        actualizarTablaDetalles(resultados);
    }
    
    /**
     * Actualiza la tabla de detalles con las publicaciones proporcionadas
     * @param {Array} publicaciones - Array de publicaciones a mostrar
     */
    function actualizarTablaDetalles(publicaciones) {
        const tablaBody = document.querySelector('#tablaDetalles tbody');
        const contador = document.getElementById('contadorDetalles');
        
        // Limpiar la tabla
        tablaBody.innerHTML = '';
        
        // Llenar la tabla con los datos o mostrar mensaje si no hay resultados
        if (publicaciones.length === 0) {
            const textoBusqueda = document.getElementById('barraBusqueda').value;
            if (textoBusqueda) {
                if (anioSeleccionadoActual) {
                    tablaBody.innerHTML = `
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 20px;">
                                No se encontraron publicaciones del a√±o ${anioSeleccionadoActual} que coincidan con la b√∫squeda
                            </td>
                        </tr>
                    `;
                } else {
                    tablaBody.innerHTML = `
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 20px;">
                                No se encontraron publicaciones que coincidan con la b√∫squeda
                            </td>
                        </tr>
                    `;
                }
            } else {
                if (anioSeleccionadoActual) {
                    tablaBody.innerHTML = `
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 20px;">
                                No hay publicaciones para el a√±o ${anioSeleccionadoActual}
                            </td>
                        </tr>
                    `;
                } else {
                    tablaBody.innerHTML = `
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 20px;">
                                No hay publicaciones disponibles
                            </td>
                        </tr>
                    `;
                }
            }
        } else {
            // Llenar la tabla con las publicaciones
            publicaciones.forEach(publicacion => {
                const titulo = columnaTituloSeleccionada ? (publicacion[columnaTituloSeleccionada] || 'Sin t√≠tulo') : 'Sin informaci√≥n de t√≠tulo';
                const autores = columnaAutoresSeleccionada ? (publicacion[columnaAutoresSeleccionada] || 'Sin autores') : 'Sin informaci√≥n de autores';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${titulo}</td>
                    <td>${autores}</td>
                `;
                tablaBody.appendChild(tr);
            });
        }
        
        // Actualizar contador con informaci√≥n contextual
        const textoBusqueda = document.getElementById('barraBusqueda').value;
        if (textoBusqueda) {
            if (anioSeleccionadoActual) {
                contador.textContent = `Mostrando ${publicaciones.length} publicaci√≥n(es) del a√±o ${anioSeleccionadoActual} que coinciden con "${textoBusqueda}"`;
            } else {
                contador.textContent = `Mostrando ${publicaciones.length} publicaci√≥n(es) de todos los a√±os que coinciden con "${textoBusqueda}"`;
            }
        } else {
            if (anioSeleccionadoActual) {
                contador.textContent = `Mostrando ${publicaciones.length} publicaci√≥n(es) del a√±o ${anioSeleccionadoActual}`;
            } else {
                contador.textContent = `Mostrando ${publicaciones.length} publicaci√≥n(es) de todos los a√±os`;
            }
        }
    }
    
    // ===== INICIALIZACI√ìN DE LA APLICACI√ìN =====
    
    /**
     * Funci√≥n que se ejecuta cuando el DOM est√° completamente cargado
     * Configura event listeners e inicia la carga de datos
     */
    document.addEventListener('DOMContentLoaded', function() {
        console.log('P√°gina cargada, iniciando carga de datos...');
        
        // Configurar event listener para el selector de a√±os
        document.getElementById('selectorAnio').addEventListener('change', function() {
            const anioSeleccionado = this.value;
            if (anioSeleccionado) {
                mostrarDetallesAnio(anioSeleccionado);
            } else {
                mostrarTodasLasPublicaciones();
            }
        });
        
        // Configurar event listener para la barra de b√∫squeda (b√∫squeda en tiempo real)
        document.getElementById('barraBusqueda').addEventListener('input', function() {
            aplicarBusqueda(this.value);
        });
        
        // Cargar datos autom√°ticamente al iniciar la p√°gina
        cargarDatos();
        
        // Configurar recarga autom√°tica cada 10 minutos para mantener datos actualizados
        setInterval(() => {
            if (!isLoading) {
                console.log('Recarga autom√°tica programada');
                currentUrlIndex = 0; // Resetear a la URL principal
                cargarDatos();
            }
        }, 600000); // 10 minutos = 600,000 milisegundos
    });
</script>
